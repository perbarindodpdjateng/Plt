<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Konfirmasi Kehadiran</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, sans-serif;
      font-size: 10px;
      margin: 0;
      padding: 2px;
      background: transparent;
      color: #f7f2f2;
    }
    .judul {
      text-align: center;
      margin: 0 0 0px;
    }
    .judul h1 {
      font-size: 16px;
      margin: 0;
      color: #1a237e;
    }
    .judul h2 {
      font-size: 14px;
      margin: 0px 0;
      color: #0d47a1;
    }
    .judul h3 {
      font-size: 10px;
      margin: 0px 0;
      color: black;
    }
    form {
      background: #fff;
      padding: 10px;
      border-radius: 6px;
      box-shadow: 0 1px 3px rgba(0,0,0,.8);
      position: relative;
    }
    input, select, button {
      width: 100%;
      padding: 7px;
      font-size: 10px;
      margin-bottom: 6px;
      border: 1px solid #bbb;
      border-radius: 4px;
    }
    button {
      background: #007bff;
      color: #fff;
      border: none;
      cursor: pointer;
    }
    button:active {
      background: #0056b3;
    }
    
    /* Loading Bar */
    #loadingBar {
      display: none;
      height: 3px;
      background: #e0e0e0;
      border-radius: 2px;
      overflow: hidden;
      margin-top: 4px;
    }
    #progressBar {
      height: 100%;
      background: #007bff;
      width: 0;
      transition: width .3s;
    }
    
    /* Blink Message Styles */
    .message {
      display: none;
      text-align: center;
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
      font-weight: bold;
      font-size: 12px;
      animation: blink 1s infinite;
    }
    .message.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .message.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    
    @keyframes blink {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0.3; }
    }
    
    /* Searchable Dropdown Styles */
    .searchable-select {
      position: relative;
      margin-bottom: 6px;
    }
    .searchable-select input {
      width: 100%;
      margin-bottom: 0;
    }
    .dropdown-list {
      display: none;
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      max-height: 150px;
      overflow-y: auto;
      background: white;
      border: 1px solid #bbb;
      border-top: none;
      border-radius: 0 0 4px 4px;
      z-index: 1000;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .dropdown-list.active {
      display: block;
    }
    .dropdown-item {
      padding: 7px;
      cursor: pointer;
      color: #333;
      border-bottom: 1px solid #eee;
    }
    .dropdown-item:hover {
      background: #007bff;
      color: white;
    }
    .dropdown-item.no-result {
      color: #999;
      cursor: default;
    }
    .dropdown-item.no-result:hover {
      background: white;
      color: #999;
    }

    /* Peserta Container Styles */
    #pesertaContainer {
      margin-bottom: 6px;
    }
    .peserta-item {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      padding: 8px;
      margin-bottom: 8px;
      border-left: 3px solid #007bff;
    }
    .peserta-item input {
      margin-bottom: 4px;
    }
    .peserta-item input:last-child {
      margin-bottom: 0;
    }
    .peserta-label {
      font-size: 9px;
      font-weight: bold;
      color: #495057;
      margin-bottom: 4px;
      display: block;
      text-transform: uppercase;
    }
  </style>
</head>
<body>

<div class="judul">
  <h2>INPUT DAFTAR PELATIHAN</h2>
  <h3>Perbarindo DPD Jateng - Yandora</h3><br>
</div>

<form id="Form">

  <select name="Pelatihan" required>
    <option>PTM Aplikasi Digital SI-RAKB (Sistem Informasi Rencana Aksi Keuangan Berkelanjutan) Versi 3 APOLO untuk Menyusun dan Menyampaikan Laporan RAKB BPR - BPRS Tahun 2026 ke OJK Satu Klik ke APOLO Laporan Keuangan Berkelanjutan</option>
  </select>
  <select name="Tgl" required>
    <option>23 Februari 2026</option>
  </select>
  <select name="Paket" required>
    <option value="">-- Pilih Paket 1/2/3 --</option>
<option>PAKET 1 : 2.950.000; 1 Org + SI-RAKB Ver.3 (hemat 0)</option>
<option>PAKET 1 : 4.200.000; 2 Org + SI-RAKB Ver.3 (hemat 1.700.000)</option>
<option>PAKET 1 : 5.450.000; 3 Org + SI-RAKB Ver.3 (hemat 3.400.000)</option>
<option>PAKET 1 : 6.700.000; 4 Org + SI-RAKB Ver.3 (hemat 5.100.000)</option>
<option>PAKET 1 : 7.950.000; 5 Org + SI-RAKB Ver.3 (hemat 6.800.000)</option>
<option>PAKET 1 : 9.200.000; 6 Org + SI-RAKB Ver.3 (hemat 8.500.000)</option>
<option>PAKET 1 : 10.450.000; 7 Org + SI-RAKB Ver.3 (hemat 10.200.000)</option>
<option>PAKET 1 : 11.700.000; 8 Org + SI-RAKB Ver.3 (hemat 11.900.000)</option>
<option>PAKET 1 : 12.950.000; 9 Org + SI-RAKB Ver.3 (hemat 13.600.000)</option>
<option>PAKET 1 : 14.200.000; 10 Org + SI-RAKB Ver.3 (hemat 15.300.000)</option>
<option>PAKET 2 : 2.050.000; 1 Org + Upgrade SI-RAKB Ver2 ke Ver3 (hemat 0)</option>
<option>PAKET 2 : 3.300.000; 2 Org + Upgrade SI-RAKB Ver2 ke Ver3 (hemat 800.000)</option>
<option>PAKET 2 : 4.550.000; 3 Org + Upgrade SI-RAKB Ver2 ke Ver3 (hemat 4.300.000)</option>
<option>PAKET 2 : 5.800.000; 4 Org + Upgrade SI-RAKB Ver2 ke Ver3 (hemat 6.000.000)</option>
<option>PAKET 2 : 7.050.000; 5 Org + Upgrade SI-RAKB Ver2 ke Ver3 (hemat 7.700.000)</option>
<option>PAKET 2 : 8.300.000; 6 Org + Upgrade SI-RAKB Ver2 ke Ver3 (hemat 9.400.000)</option>
<option>PAKET 2 : 9.550.000; 7 Org + Upgrade SI-RAKB Ver2 ke Ver3 (hemat 11.100.000)</option>
<option>PAKET 2 : 10.800.000; 8 Org + Upgrade SI-RAKB Ver2 ke Ver3 (hemat 12.800.000)</option>
<option>PAKET 2 : 12.050.000; 9 Org + Upgrade SI-RAKB Ver2 ke Ver3 (hemat 14.500.000)</option>
<option>PAKET 2 : 13.300.000; 10 Org + Upgrade SI-RAKB Ver2 ke Ver3 (hemat 16.200.000)</option>
<option>PAKET 3 : 1.400.000; 1 Org Plt Refresment (hemat 0)</option>
<option>PAKET 3 : 2.650.000; 2 Org Plt Refresment (hemat 150.000)</option>
<option>PAKET 3 : 3.900.000; 3 Org Plt Refresment (hemat 4.950.000)</option>
<option>PAKET 3 : 5.150.000; 4 Org Plt Refresment (hemat 6.650.000)</option>
<option>PAKET 3 : 6.400.000; 5 Org Plt Refresment (hemat 8.350.000)</option>
<option>PAKET 3 : 7.650.000; 6 Org Plt Refresment (hemat 10.050.000)</option>
<option>PAKET 3 : 8.900.000; 7 Org Plt Refresment (hemat 11.750.000)</option>
<option>PAKET 3 : 10.150.000; 8 Org Plt Refresment (hemat 13.450.000)</option>
<option>PAKET 3 : 11.400.000; 9 Org Plt Refresment (hemat 15.150.000)</option>
<option>PAKET 3 : 12.650.000; 10 Org Plt Refresment (hemat 16.850.000)</option>
  </select>

  <select name="DPK" required>
    <option value="">-- DPK/Eks.Karesidenan/LuarJateng/Umum --</option>
    <option>DPK Soloraya</option>
    <option>DPK Semarang</option>
    <option>DPK Kedu</option>
    <option>DPK Banyumas</option>
    <option>DPK Pati</option>
    <option>DPK Tegal (Pekalongan)</option>
    <option>Luar Jateng</option>
    <option>Umum</option>
  </select>
  
  <!-- Searchable NamaBPR -->
  <div class="searchable-select">
    <input type="text" id="NamaBPRInput" placeholder="Cari-Pilih NamaBPR / Ketik (klo tdk ada)" autocomplete="off" required>
    <input type="hidden" name="NamaBPR" id="NamaBPRHidden">
    <div class="dropdown-list" id="BPRDropdown"></div>
  </div>

  <input name="ContactNama" placeholder="Contact Person (Nama)">
  <input type="tel" name="ContactNoWA" placeholder="Contact Person (NoWA), contoh:85727051675">
  
  <!-- Select Jumlah Peserta -->
  <select name="JumlahPeserta" id="JumlahPeserta" required>
    <option value="">-- Pilih Jumlah Peserta --</option>
    <option value="1">Peserta 1 Orang</option>
    <option value="2">Peserta 2 Orang</option>
    <option value="3">Peserta 3 Orang</option>
    <option value="4">Peserta 4 Orang</option>
    <option value="5">Peserta 5 Orang</option>
    <option value="6">Peserta 6 Orang</option>
    <option value="7">Peserta 7 Orang</option>
    <option value="8">Peserta 8 Orang</option>
    <option value="9">Peserta 9 Orang</option>
    <option value="10">Peserta 10 Orang</option>
  </select>

  <!-- Container untuk Field Peserta Dinamis -->
  <div id="pesertaContainer"></div>
  
  <!-- Message Containers -->
  <div id="successMessage" class="message success">✅ Data berhasil dikirim!</div>
  <div id="errorMessage" class="message error">❌ Terjadi kesalahan saat mengirim data!</div>

  <button type="submit">Kirim</button>
  <div id="loadingBar"><div id="progressBar"></div></div>
</form>

<script>
  // Data NamaBPR
  const bprList = [
"MAJATAMA",
"KENDAL KOTA",
"BANK PEMALANG"
  ];

  // Searchable Dropdown Logic
  const namaBPRInput = document.getElementById('NamaBPRInput');
  const namaBPRHidden = document.getElementById('NamaBPRHidden');
  const dropdown = document.getElementById('BPRDropdown');
  
  function renderDropdown(filter = '') {
    dropdown.innerHTML = '';
    const filtered = bprList.filter(item => 
      item.toLowerCase().includes(filter.toLowerCase())
    );
    
    if (filtered.length === 0) {
      const div = document.createElement('div');
      div.className = 'dropdown-item no-result';
      div.textContent = 'Tidak ada hasil';
      dropdown.appendChild(div);
    } else {
      filtered.forEach(item => {
        const div = document.createElement('div');
        div.className = 'dropdown-item';
        div.textContent = item;
        div.onclick = () => {
          namaBPRInput.value = item;
          namaBPRHidden.value = item;
          dropdown.classList.remove('active');
        };
        dropdown.appendChild(div);
      });
    }
  }
  
  namaBPRInput.addEventListener('focus', () => {
    renderDropdown(namaBPRInput.value);
    dropdown.classList.add('active');
  });
  
  namaBPRInput.addEventListener('input', (e) => {
    renderDropdown(e.target.value);
    dropdown.classList.add('active');
    // Reset hidden input saat mengetik manual
    namaBPRHidden.value = e.target.value;
  });
  
  // Tutup dropdown saat klik di luar
  document.addEventListener('click', (e) => {
    if (!e.target.closest('.searchable-select')) {
      dropdown.classList.remove('active');
    }
  });

  // Logic untuk Generate Field Peserta Dinamis
  const jumlahPesertaSelect = document.getElementById('JumlahPeserta');
  const pesertaContainer = document.getElementById('pesertaContainer');

  function renderPesertaFields(jumlah) {
    pesertaContainer.innerHTML = '';
    
    if (!jumlah || jumlah < 1) return;
    
    for (let i = 1; i <= jumlah; i++) {
      const pesertaDiv = document.createElement('div');
      pesertaDiv.className = 'peserta-item';
      pesertaDiv.innerHTML = `
        <span class="peserta-label">Data Peserta ${i}</span>
        <input type="text" name="PesertaNama${i}" placeholder="Peserta ${i} (Nama)" required>
        <input type="tel" name="PesertaNoWA${i}" placeholder="Peserta ${i} (NoWA), contoh:85727051675" required>
      `;
      pesertaContainer.appendChild(pesertaDiv);
    }
  }

  // Event listener untuk perubahan jumlah peserta
  jumlahPesertaSelect.addEventListener('change', function() {
    const jumlah = parseInt(this.value) || 0;
    renderPesertaFields(jumlah);
  });

  // Form Submit Logic
  const scriptURL = 'https://script.google.com/macros/s/AKfycbxOCvx4PSyJGNUU1okV7ClVVqZGa4XSvrTmJ7i6wCST_h9dtPd7dYwFVtCSj5blR8IKnA/exec   ';
  const form = document.getElementById('Form');
  const loadingBar = document.getElementById('loadingBar');
  const progressBar = document.getElementById('progressBar');
  const successMsg = document.getElementById('successMessage');
  const errorMsg = document.getElementById('errorMessage');

  form.addEventListener('submit', e => {
    e.preventDefault();
    
    // Validasi: cek apakah jumlah peserta sudah dipilih
    if (!jumlahPesertaSelect.value) {
      alert('Silakan pilih jumlah peserta terlebih dahulu!');
      jumlahPesertaSelect.focus();
      return;
    }
    
    // Sembunyikan pesan sebelumnya
    successMsg.style.display = 'none';
    errorMsg.style.display = 'none';
    
    loadingBar.style.display = 'block';
    progressBar.style.width = '30%';
    
    fetch(scriptURL, { method: 'POST', body: new FormData(form) })
      .then(() => {
        progressBar.style.width = '100%';
        setTimeout(() => {
          loadingBar.style.display = 'none';
          progressBar.style.width = '0%';
          successMsg.style.display = 'block';
          form.reset();
          namaBPRHidden.value = '';
          pesertaContainer.innerHTML = ''; // Kosongkan field peserta
          
          // Hilangkan pesan setelah 5 detik
          setTimeout(() => {
            successMsg.style.display = 'none';
          }, 5000);
        }, 300);
      })
      .catch(() => {
        loadingBar.style.display = 'none';
        progressBar.style.width = '0%';
        errorMsg.style.display = 'block';
        
        // Hilangkan pesan setelah 5 detik
        setTimeout(() => {
          errorMsg.style.display = 'none';
        }, 5000);
      });
  });
</script>
</body>
</html>
